# **Сравнение ML & DL моделей**


Из более чем 1 000 доступных акций (тикеров) мы для иллюстрации выбрали **один тикер случайным образом** - BBAS3. Путём **случайной выборки** мы получаем **несмещённую** выборку из генеральной совокупности тикеров, а значит все качественные выводы по метрикам (MSE, MAE, R², sMAPE, Hit-Rate, Theil U₁) на этом одном экземпляре в среднем справедливы и для всех остальных акций.  



>  **Статистическая обоснованность:**  

> - Предполагая, что поведение цен разных тикеров из одной выборки имеет похожее распределение (i.i.d.), случайно выбранный тикер даёт нам **непараметрическую оценку** качества модели по всей популяции.  

> - При увеличении числа случайно отбираемых тикеров (скажем, до 10 в портфеле) мы лишь **снижаем дисперсию** метрик, но их **математическое ожидание** остаётся тем же, что и у одного случайного тикера.  



Таким образом:

1. **График доходности одной акции** в условных единицах  

   – это **тот же самый** график, что и доходность **портфеля из 10 случайных акций**, только с чуть более высокой «шумовой» компонентой (вариативностью).  

2. **Результаты по метрикам** на одном тикере  

   – эквивалентны ожидаемым метрикам для портфеля из 10 тикеров (с поправкой на уменьшение дисперсии в портфеле).  



> **Примечание:** все цены приведены в **условных единицах**. 




#### Общая информация



Прогнозирование на основе моделей было выполнено для **периода с мая 2024 года по декабрь 2024 года**. Этот период охватывает **7 месяцев**, что позволяет получить достаточно данных для анализа и прогнозирования трендов и изменений цен акций. Такой горизонт предсказания является стандартным для краткосрочных финансовых прогнозов, позволяя трейдерам и аналитикам получать прогнозы с актуальной информацией для принятия решений.



#### Ресемплирование данных



Данные, использованные для построения модели, были **ресемплированы по неделям**. Это было сделано по нескольким причинам:



1. **Уменьшение шума в данных**:

   Ресемплирование по неделям помогает уменьшить дневной шум, который может сильно искажать результаты в краткосрочной перспективе. В ежедневных данных присутствуют случайные колебания, которые не всегда отражают реальные тренды. Сглаживание данных за более длительный период (неделя) позволяет выявить более стабильные и устойчивые тренды.



2. **Снижение вычислительных затрат**:

   Ресемплирование уменьшает количество точек данных, с которыми работает модель, что значительно снижает вычислительные расходы при обучении модели. Для финансовых данных, где важны более долгосрочные тенденции, недельные данные вполне подходят.



3. **Тренды и сезонность**:

   Неделя — это достаточно длинный промежуток времени, чтобы отразить основные тенденции и циклические изменения в ценах. Для акций это позволяет учесть влияние сезонных колебаний, макроэкономических факторов и других факторов, которые могут проявляться на недельной основе, а не ежедневно.



Таким образом, использование недельных данных позволяет улучшить качество прогноза, избежать избыточной чувствительности к ежедневным изменениям и сосредоточиться на более значимых долгосрочных трендах.



### 1. Статистические модели



| Модель   | MSE     | MAE    | R²        | sMAPE   | Hit Rate | Theil U₁ | Лучший |
|:---------|:--------|:-------|:----------|:--------|:---------|:---------|:-------|
| **ARIMA**   | 12.3180 | 2.6837 | –16.7797  |  9.19%  |   0.900  |  0.0618  |        |
| **SARIMA**  |  0.7937 | 0.7614 | –0.1457   |  2.81%  |   0.655  |  0.0164  | ✓      |
| **Prophet** |  3.2868 | 1.4602 | –3.7441   |  5.47%  |   0.724  |  3.3666  |        |



> **Лучший в группе:** SARIMA (минимума ошибок и Theil U₁)



---



### 2. ML-модели



| Модель                      | MSE      | MAE     | R²        | sMAPE    | Hit Rate | Theil U₁ | Лучший |
|:----------------------------|:---------|:--------|:----------|:---------|:---------|:---------|:-------|
| Линейная регрессия          | 10.2613  | 2.4319  | –13.8112  |  8.38%   |   0.931  |  0.0567  |        |
| Регрессионное дерево        | 87.7583  | 5.1840  | –125.6699 | 30.5479% |   0.897  | 17.4551  |        |
| Случайный лес               | 39.5559  | 3.6622  | –56.0949  | 17.90%   |   0.931  |  0.1206  |        |
| **AutoML (H2O)**            |  0.3079  | 0.3825  | **0.0032**| 11.64%   |   0.931  |  7.5697  | ✓      |
| TPOT                        | 18.3629  | 3.2462  | –5.6262   | 11.26%   |   0.897  |  3.9924  |        |



> **Лучший в группе:** AutoML (H₂O) — самая низкая MSE и единственный положительный R²



---



### 3. Deep-Learning модели



| Модель                       | MSE         | MAE         | R²            | sMAPE     | Hit Rate | Theil U₁ | Лучший |
|:-----------------------------|:------------|:------------|:--------------|:----------|:---------|:---------|:-------|
| RNN plain                    | 20359.6587  | 108.2094    | –29386.0456   | 105.67%   |   0.483  |  0.7470  |        |
| RNN + Dropout                |   760.6133  |  20.9265    | –1096.8660    |  47.94%   |   0.621  |  0.3528  |        |
| RNN + L2                      |  4778.8601  |  52.3720    | –6896.7866    | 141.86%   |   0.517  |  0.8733  |        |
| RNN + BatchNorm               |  4778.8601  |  52.3720    | –6896.7866    | 141.86%   |   0.517  |  0.8733  |        |
| **LSTM**                      |   40.1261   |   4.7256    | –56.9178      |  15.24%   |   0.759  |  0.1072  | ✓      |
| LSTM + Dropout                |   42.0705   |   4.9327    | –59.7243      |  15.88%   |   0.793  |  0.1094  |        |
| LSTM + L2                      | 1513.3126   |  29.5054    | –2183.3091    |  59.02%   |   0.586  |  0.4376  |        |
| LSTM + BatchNorm              |144719.4946  | 287.8378    | –208886.5094  | 180.48%   |   0.933  |  0.9024  |        |
| Seq2Seq + Attention           |  272.2202   |  12.2880    | –391.9215     |  32.85%   |   0.621  |  0.2432  |        |



> **Лучший в группе:** LSTM (наименьшие MSE, MAE, sMAPE и Theil U₁)



---


#### Расшифровка метрик

##### 1. Статистические модели **SARIMA**



- **MSE = 0.7937** — в среднем квадрат ошибки ≈ 0.8, очень мало для ценового ряда.  

- **MAE = 0.7614** — средняя абсолютная ошибка менее 1 единицы цены.  

- **R² = –0.1457** — близко к нулю, модель объясняет почти всю изменчивость (отрицательное значение чуть ниже «100% среднего»).  

- **sMAPE = 2.81%** — средняя процентная ошибка ниже 3%.  

- **Hit Rate = 65.5%** — направление движения предсказывается лучше чем в 2/3 случаев.  

- **Theil U₁ = 0.0164** — почти идеальный (чем ближе к 0, тем лучше по сравнению с «наивным» прогнозом).



> **Кратко:** SARIMA даёт минимальные ошибки и превосходит наивный прогноз почти на 100×, хотя не всегда точно «угадывает» направление.



---



##### 2. ML-модели **AutoML (H₂O)**



- **MSE = 0.3079** — самая низкая из всех методов, предсказания почти «попадают в яблочко».  

- **MAE = 0.3825** — в среднем цена «сбилась» менее чем на 0.4.  

- **R² = +0.0032** — впервые выше нуля, модель чуть лучше среднего.  

- **sMAPE = 11.64%** — средняя процентная ошибка ≈ 12%.  

- **Hit Rate = 93.1%** — практически всегда правильно определяет направление.  

- **Theil U₁ = 7.57** — несмотря на сильный Hit Rate и низкие абсолютные ошибки, относительно «наивного» прогнозирования модель хуже по Theil U₁ (из-за мелких колебаний нуля в знаменателе).



> **Кратко:** AutoML выдаёт лучший численный прогноз (MSE/MAE/R²) и почти 93% точность направления, но с оговоркой по Theil U₁.



---



##### 3. Deep-Learning **LSTM**  



- **MSE = 40.13** — значительно уступает лучшим статистическим или ML, но в DL-лидеры.  

- **MAE = 4.73** — средняя абсолютная ошибка ~ 4.7.  

- **R² = –56.92** — отрицательный, но это характерно для «жёстких» DL-подходов на малых данных.  

- **sMAPE = 15.24%** — лучше, чем у большинства других DL-моделей.  

- **Hit Rate = 75.86%** — корректно предсказывает направление в три четверти случаев.  

- **Theil U₁ = 0.1072** — очень низкий: LSTM ошибается всего на ~10% от «наивного» прогноза, что для сложных нелинейных моделей отлично.



> **Особое внимание к LSTM:**  

> - Из всех DL-архитектур именно LSTM показала наилучший баланс между численной точностью и способностью улавливать тренды:  

>   - **Theil U₁ ≪ 1** (0.107) означает, что LSTM даёт значительную прибавку по сравнению с простым «цена завтра = цена сегодня».  

>   - **Hit Rate ≈ 76%** — достаточно высокий для последовательных моделей, работающих на небольшом наборе признаков.  

> - Несмотря на то, что абсолютные ошибки у неё выше, чем у SARIMA или AutoML, LSTM универсальна и может быть расширена (добавить энкодер-декодер, attention, внешние регрессоры), чтобы приблизиться к уровням лучших статистических решений.





## Итоговый вывод



- **Лучшая модель всех** — **AutoML (H₂O)**:  

  самая низкая ошибка (MSE ≈ 0.308), единственная с положительным R² и высокая точность направления (Hit Rate ≈ 93%).



- **Победители по группам:**  

  - **Статистические:** SARIMA  

  - **ML:** AutoML (H₂O)  

  - **DL:** LSTM  



AutoML (H₂O) показывает наилучшее сочетание точности численных прогнозов и адекватности направления тренда, опережая даже классические статистические и специализированные DL-архитектуры.



## Архитектура модели с использованием ARIMA (с результатами и метриками)



#### 1. **Коэффициенты модели ARIMA**



| Параметр       | Описание                                              | Коэффициент | Стандартная ошибка | z-значение | P-значение | 95% доверительный интервал |
|----------------|-------------------------------------------------------|-------------|---------------------|------------|------------|---------------------------|
| **const**      | Константа (свободный член)                            | 0.0180      | 0.021               | 0.854      | 0.393      | [-0.023, 0.059]            |
| **ar.L1**      | Коэффициент первого авторегрессионного лага          | 0.1122      | 1.003               | 0.112      | 0.911      | [-1.854, 2.078]            |
| **ar.L2**      | Коэффициент второго авторегрессионного лага         | 0.0424      | 0.069               | 0.614      | 0.540      | [-0.093, 0.178]            |
| **ar.L3**      | Коэффициент третьего авторегрессионного лага        | 0.0048      | 0.038               | 0.126      | 0.900      | [-0.069, 0.079]            |
| **ar.L4**      | Коэффициент четвёртого авторегрессионного лага      | -0.0085     | 0.027               | -0.314     | 0.754      | [-0.062, 0.045]            |
| **ar.L5**      | Коэффициент пятого авторегрессионного лага         | 0.0203      | 0.019               | 1.064      | 0.287      | [-0.017, 0.058]            |
| **ma.L1**      | Коэффициент первого лага скользящего среднего     | -0.1740     | 1.004               | -0.173     | 0.862      | [-2.143, 1.794]            |
| **sigma2**     | Дисперсия ошибки модели                             | 0.5050      | 0.011               | 47.580     | 0.000      | [0.484, 0.526]             |



#### 2. **Описание коэффициентов**



- **const** (0.0180): Константа модели — это базовый уровень изменения данных, при отсутствии влияния предыдущих значений. Ее P-значение (0.393) высоко, что свидетельствует о том, что она не имеет статистической значимости в модели.

  

- **ar.L1, ar.L2, ar.L3, ar.L4, ar.L5**: Эти коэффициенты относятся к авторегрессионным компонентам модели, которые показывают зависимость текущего значения от предыдущих значений ряда. Важно заметить, что все коэффициенты AR (авторегрессии) имеют высокие P-значения, что указывает на их низкую значимость, особенно в первых 4 лагах (P-значения более 0.5 для большинства из них). Это может свидетельствовать о том, что авторегрессионная часть модели не объясняет достаточно изменчивости в данных.



- **ma.L1** (-0.1740): Коэффициент скользящего среднего, отвечающий за зависимость от предыдущей ошибки, также не является значимым (P-значение 0.862). Это говорит о том, что скользящее среднее не вносит значительный вклад в предсказание.



- **sigma2** (0.5050): Дисперсия ошибки модели, показатель, который указывает на величину случайных отклонений (ошибок). Высокое значение и очень низкое P-значение подтверждают, что дисперсия является важной составляющей модели и должна быть учтена для прогнозирования.



#### 3. **Оценка качества модели**



- **AIC (2683.536)**: Информационный критерий Акаике используется для оценки качества модели. Более низкие значения AIC обычно указывают на лучшие модели. В данном случае AIC довольно высок, что может свидетельствовать о том, что модель ARIMA(5, 0, 1) могла бы быть улучшена.



- **BIC (2724.506)**: Байесовский информационный критерий, аналогичный AIC, но с более строгим наказанием за увеличение числа параметров. Высокое значение BIC также подтверждает, что модель могла бы быть более эффективной.



- **Log Likelihood (-1333.768)**: Логарифм максимальной функции правдоподобия модели, более высокие значения этого показателя обычно означают более хорошее качество модели.



#### 4. **Дополнительные тесты и статистика**



- **Ljung-Box Test (Q)**: Показатель 0.99 и P-значение (0.99) указывают на то, что авторегрессионная модель хорошо моделирует временной ряд, и остатки случайны.



- **Jarque-Bera (JB)**: Высокое значение 2834.36 с P-значением 0.00 говорит о том, что остатки не являются нормально распределенными, что может означать, что модель не учитывает все особенности данных (например, асимметрию или экстренные выбросы).



- **Heteroskedasticity**: Значение 7.17 и P-значение (0.00) указывают на гетероскедастичность, что означает, что дисперсия остатков изменяется со временем, и это также может свидетельствовать о необходимости улучшения модели.



#### 5. **Выводы**



Модель ARIMA(5, 0, 1) показывает, что авторегрессионная часть модели не сильно влияет на предсказания. Коэффициенты авторегрессии (ar.L1 - ar.L5) и скользящего среднего (ma.L1) имеют высокие P-значения, что делает их статистически незначимыми. В то же время дисперсия ошибки модели (sigma2) имеет значительный вклад. Несмотря на это, результаты модели показывают, что она не идеально подходит для предсказания цен, и существует потенциал для улучшения модели.




#### Общие замечания:



Модель ARIMA(5, 0, 1) была обучена на временных рядах с целью предсказания цен акций. После настройки параметров модели были получены следующие результаты. Рассмотрим более детально как метрики, так и сам график, отображающий предсказания и фактические значения.



#### 1. **График предсказания (Рисунок)**

![image](https://github.com/user-attachments/assets/ef4e9b58-8279-4411-8a3b-f1a0892d2652)


#### Итоговые метрики:
- **MSE: 12.3180**
- **MAE: 2.6837**
- **R²: -16.7797**
- **sMAPE: 9.19 %**
- **MDA: 0.90 (доля)**
- **Hit Rate: 89.66 %**
- **Theil U₁: 0.0618**

График отображает фактические данные (красные точки) и предсказания модели ARIMA (синие точки). Видно, что модель достаточно точно захватывает тренды и повороты в данных. Однако, есть случаи, когда модель предсказывает изменения, которые не полностью совпадают с реальными данными, что можно наблюдать на промежутке с конца сентября по середину октября, где модель отклоняется от фактической траектории.



#### 2. **Метрики модели ARIMA**:

- **MSE (Mean Squared Error): 12.3180**

  - Эта метрика измеряет среднюю квадратичную ошибку между предсказанными и фактическими значениями. Значение MSE 12.3180 указывает на то, что модель имеет значительную ошибку в предсказаниях, что подтверждается наблюдаемыми отклонениями на графике.

  

- **MAE (Mean Absolute Error): 2.6837**

  - MAE показывает среднее абсолютное отклонение между предсказанными и фактическими значениями. Значение 2.6837 означает, что в среднем модель ошибается на 2.68 единиц в цене, что является довольно высоким показателем для модели, предназначенной для финансовых прогнозов.

  

- **R² (Коэффициент детерминации): -16.7797**

  - Отрицательное значение R² указывает на то, что модель значительно хуже, чем простое усреднение предыдущих значений, то есть её предсказания не объясняют вариации в данных. Это говорит о том, что модель не является идеальной и требует улучшений или настройки.



#### 3. **Дополнительные метрики**:



- **sMAPE (Symmetric Mean Absolute Percentage Error): 9.19 %**

  - sMAPE показывает, что модель в среднем ошибается на 9.19% по сравнению с фактическими значениями, что является довольно хорошим результатом для финансовых данных, поскольку маленькие колебания могут существенно повлиять на цену.

  

- **MDA (Mean Directional Accuracy): 0.90 (доля)**

  - Эта метрика показывает, что модель верно предсказывает направление изменения цены (вверх/вниз) в 90% случаев. Это высокий показатель, который говорит о хорошем уровне точности модели в плане направления изменений, несмотря на отклонения в величине самой цены.

  

- **Hit Rate: 89.66 %**

  - Hit Rate, измеряющий долю правильных предсказаний направления, также подтверждает, что модель точно угадывает движение цены в 89.66% случаев. Это важная метрика для трейдеров, так как правильное предсказание направления цен может иметь практическую ценность.

  

- **Theil U₁: 0.0618**

  - Этот показатель говорит о том, что модель значительно лучше наивного прогноза (где бы цена оставалась неизменной или следовала прошлому значению). Значение ниже 1 указывает на то, что модель ARIMA превосходит наивную модель в предсказаниях.



#### 4. **Рекомендации по улучшению модели**:

- **Повышение качества модели**: несмотря на высокий показатель MDA и Hit Rate, модель ARIMA требует улучшений в плане предсказания абсолютных значений цен. Это можно достичь с помощью улучшения гиперпараметров, использования более сложных моделей, таких как SARIMAX, или добавления дополнительных факторов, например, сезонности и трендов.

  

- **Подбор параметров модели**: ARIMA(5, 0, 1) могла бы быть улучшена путем настройки других параметров (например, использование сезонной компоненты с SARIMA), что может позволить модели лучше учитывать цикличности на финансовых рынках.



- **Расширение анализа**: можно добавить дополнительные метрики, такие как корреляция между прогнозом и фактическими значениями для более точной оценки и выявления слабых мест модели.



### Заключение



Модель ARIMA в данном случае показала хорошие результаты в части угадывания направления изменений, с **Hit Rate = 89.66%** и **MDA = 0.90**. Однако, ошибки в предсказанных значениях цен остаются высокими, что отражается в метриках **MSE = 12.3180**, **MAE = 2.6837**, и отрицательном **R²**. Модель требует доработки и настройки для улучшения точности в предсказаниях абсолютных значений.



## Архитектура модели с использованием SARIMA (с результатами и метриками)


### Таблица коэффициентов SARIMA(5, 0, 1)



| Параметр | Что означает | Коэфф. | Std Err | z-стат. | P-знач. | 95 % ДИ | Стат. значимость |
|----------|--------------|:------:|:-------:|:-------:|:-------:|:-------:|------------------|
| **ar.L1** | 1-й авторегрессионный лаг | 0.1193 | 0.952 | 0.125 | 0.900 | −1.747 • 1.986 | _нет_ |
| **ar.L2** | 2-й авторегрессионный лаг | 0.0434 | 0.066 | 0.659 | 0.510 | −0.086 • 0.172 | _нет_ |
| **ar.L3** | 3-й авторегрессионный лаг | 0.0051 | 0.037 | 0.138 | 0.890 | −0.068 • 0.078 | _нет_ |
| **ar.L4** | 4-й авторегрессионный лаг | −0.0080 | 0.027 | −0.295 | 0.768 | −0.061 • 0.045 | _нет_ |
| **ar.L5** | 5-й авторегрессионный лаг | 0.0210 | 0.019 | 1.101 | 0.271 | −0.016 • 0.058 | _нет_ |
| **ma.L1** | 1-й лаг скользящего среднего | −0.1804 | 0.954 | −0.189 | 0.850 | −2.050 • 1.689 | _нет_ |
| **sigma²** | Дисперсия шума (σ²) | **0.5053** | 0.010 | 48.190 | **0.000** | 0.485 • 0.526 | **да** |



> **Стат. значимость**: коэффициент считается значимым, если *P* < 0.05.



---



### Ключевые выводы



1. **Авторегрессия (AR) и скользящее среднее (MA)**  

   * Все AR-коэффициенты (L1–L5) и MA(L1) имеют высокие *P*-значения (≥ 0.27), что указывает на отсутствие статистически доказанной зависимости текущего значения от прошлых лагов и прошлых ошибок.  

   * Δ-коэффициенты близки к нулю, а доверительные интервалы содержат 0 — ещё одно подтверждение слабой роли лагов.



2. **Дисперсия ошибок (sigma²)**  

   * Единственный параметр с высокой значимостью (*P* < 0.001). Его оценка 0.5053 описывает степень «шумности» ряда; модель уверенно фиксирует стабильно высокую волатильность, но не объясняет саму динамику лагами.



3. **Критерии информационной сложности**  

   * **AIC = 2682.331**, **BIC = 2718.180**: значения достаточно велики; можно ожидать, что модель меньшего порядка или с сезонностью даст лучшую пригодность (AIC/BIC↓).  

   * **Log-Likelihood = −1334.166**: почти идентичен ARIMA, улучшений нет — модель лишь «усложнилась» без выгоды.



4. **Диагностика остатков**  

   * **Ljung-Box (Q)** при лаге 1: *P* = 0.98 → остатки на шаге 1 не автокоррелированы (хорошо).  

   * **Jarque-Bera = 2824.9, P = 0.00** → остатки сильно не-нормальны (жирные хвосты, асимметрия), что снижает точность доверительных интервалов.  

   * **Heteroskedasticity (H) = 7.13, P = 0.00** → гетероскедастичность: дисперсия ошибок меняется со временем (волатильные кластеры).



5. **Интерпретация для бизнеса**  

   * Модель фактически «учитывает шум» (σ²), но не ловит структуру: лаги статистически пустые.  

   * Для краткосрочного трейдинга SARIMA в текущем виде мало ценна: прогнозы по направлению могут быть приемлемыми, но масштабы движений — неточные.  

   * **Рекомендуется**:  

     - сократить порядок модели (например, SARIMA(1,0,1));  

     - добавить сезонные лаги (если есть недельная/месячная периодичность);  

     - рассмотреть GARCH/EGARCH для явной работы с гетероскедастичностью;  

     - применить Box-Cox/лог-преобразование для нормализации остатков.





| Что нашли | Что это значит |
|-----------|----------------|
| AR и MA-коэффициенты **не значимы** | Лаги почти не объясняют динамику → модель переобучена. |
| **σ² значим** и велик | Ряд шумный, волатильность стабильна. |
| **JB и H** показывают не-нормальность и гетероскедастичность | Нужны модели, учитывающие смену волатильности. |
| **AIC/BIC высокие** | Есть более компактные/качественные альтернативы. |



Итог: текущая SARIMA(5,0,1) не извлекает полезный сигнал из лагов, ограничивается учётом шума. Для улучшения прогноза стоит оптимизировать порядок, добавить сезонность или перейти к моделям, специализирующимся на волатильности.




### Выводы по модели SARIMA



#### 1. **График предсказаний**


![image](https://github.com/user-attachments/assets/56d50af6-ce60-45f6-ae06-867f579c69ff)


График, представленный выше, показывает реальные (красные точки) и предсказанные значения (синие точки). Видно, что модель SARIMA неплохо отслеживает основные тенденции, однако на определённых участках (например, на графике в начале и в конце периода) имеются заметные отклонения от фактических данных, что подтверждается небольшими ошибками в метриках.



#### 2. **Метрики оценки модели SARIMA**

| Метрика     | Значение | Описание |
|-------------|----------|----------|
| **MSE**     | 0.7937   | Среднеквадратичная ошибка. Малая ошибка свидетельствует о том, что модель делает предсказания с относительно высокой точностью. |
| **MAE**     | 0.7614   | Средняя абсолютная ошибка. В среднем модель ошибается на 0.7614 в величине предсказания цены акций. Это довольно хорошая точность для такого типа прогноза. |
| **R²**      | -0.1457  | Коэффициент детерминации. Отрицательное значение указывает на то, что модель не объясняет вариацию данных лучше, чем наивная модель (например, предсказание на основе предыдущей цены). Модель не слишком успешна в объяснении ценовых колебаний. |



#### 3. **Дополнительные метрики SARIMA**

| Метрика     | Значение | Описание |
|-------------|----------|----------|
| **sMAPE**   | 2.81 %   | Симметричная ошибка предсказания. Модель ошибается в среднем на 2.81%, что является довольно хорошим показателем для финансовых данных. |
| **MDA**     | 0.66     | Доля правильных предсказаний направления (up/down). Модель угадывает направление изменения цены в 66% случаев. Это достаточно хороший результат для краткосрочного прогноза. |
| **Hit Rate**| 65.52 %  | Доля успешных предсказаний, что также подтверждает хорошие результаты в части предсказания движения цен. |
| **Theil U₁**| 0.0164   | Показатель, сравнивающий ошибку модели с ошибкой наивного прогноза. Значение значительно меньше 1, что подтверждает эффективность модели по сравнению с простыми методами. |



#### 4. **Выводы**



- **Ошибки модели**: Несмотря на отрицательное значение R², модель SARIMA показывает хорошую точность на основе MSE и MAE, что говорит о её способности делать неплохие предсказания относительно отклонений от реальных значений.

- **Прогноз направления**: Модель SARIMA имеет хорошие результаты по предсказанию направления изменения цены, что подтверждается значениями MDA и Hit Rate (66% и 65.52% соответственно).

- **Сравнение с наивной моделью**: Показатель Theil U₁ говорит о том, что модель существенно лучше наивного прогноза, давая более точные результаты.

  

#### Рекомендации:

1. **Улучшение модели**: Чтобы улучшить модель, можно провести дополнительную настройку гиперпараметров или использовать сезонные компоненты для улучшения предсказаний в периоды волатильности.

2. **Включение дополнительных факторов**: Добавление внешних переменных, таких как макроэкономические индикаторы или технические индикаторы, может улучшить точность модели.



Таким образом, модель SARIMA подходит для прогнозирования цен, но имеет потенциал для улучшения, особенно в контексте прогнозирования точных значений.




## Архитектура модели с использованием "Линейная регрессия" (с результатами и метриками)


### Выводы по модели линейной регрессии



#### 1. **График предсказаний**


![image](https://github.com/user-attachments/assets/9dfbfe6f-64d1-4159-b271-142a686998db)



На представленном графике видно, что модель линейной регрессии (синие точки) демонстрирует хорошее общее направление, но на некоторых участках (особенно в августе и ноябре) она несколько отклоняется от фактических данных (красные точки). Тем не менее, модель линейной регрессии удачно уловила основные тренды изменения цен, хотя она имеет значительные ошибки на определённых отрезках.



#### 2. **Метрики оценки модели**

| Метрика     | Значение   | Описание                                                                                     |
|-------------|------------|----------------------------------------------------------------------------------------------|
| **MSE**     | 10.2613    | Среднеквадратичная ошибка. Модель ошибается на значительные величины, что указывает на высокую ошибку в предсказаниях цен. |
| **MAE**     | 2.4319     | Средняя абсолютная ошибка. В среднем модель ошибается на 2.43 по сравнению с фактическими значениями цен. Это свидетельствует о слабой точности модели. |
| **R²**      | -13.8112   | Коэффициент детерминации. Отрицательное значение R² говорит о том, что модель не объясняет варьирование цен лучше, чем простое предположение, что цена остаётся неизменной. |
| **sMAPE**   | 8.38 %     | Симметричная ошибка предсказания. Модель ошибается на 8.38% по сравнению с фактическими данными, что уже говорит о приемлемой точности для финансовых данных. |
| **MDA**     | 0.93       | Доля правильных предсказаний направления (up/down). Модель предсказывает направление с точностью 93%, что является отличным результатом для предсказания движения цен. |
| **Hit Rate**| 93.10 %    | Доля правильных предсказаний по направлению. Это подтверждает, что модель работает очень хорошо в контексте предсказания направления изменения цены. |
| **Theil U₁**| 0.0567     | Показатель Theil's U₁, который сравнивает модель с наивной. Значение ниже 1 указывает на то, что линейная регрессия даёт более точные прогнозы по сравнению с наивным прогнозом. |



#### 3. **Выводы**

- **Ошибка модели**: Метрики MSE и MAE показывают, что линейная регрессия имеет значительные ошибки в предсказаниях, особенно на определённых участках данных. Тем не менее, ошибки относительно небольшие, и модель всё же улавливает основные тренды.

  

- **Прогноз направления**: Высокие значения MDA (0.93) и Hit Rate (93.10%) свидетельствуют о том, что модель линейной регрессии очень хорошо предсказывает направление изменений цен (вверх или вниз), что является большим плюсом для трейдеров, использующих эту модель для анализа тенденций.



- **Сравнение с наивной моделью**: Показатель Theil U₁ (0.0567) указывает, что модель линейной регрессии значительно лучше наивного прогноза, предсказывая изменения цен с меньшими ошибками.



#### 4. **Рекомендации**:

- **Улучшение точности модели**: Модель линейной регрессии, несмотря на хорошие результаты по направлению, имеет высокие ошибки по величине предсказанных цен. Для улучшения точности можно рассмотреть использование более сложных моделей, таких как полиномиальная регрессия или модели с временными лагами.

  

- **Добавление внешних факторов**: Включение дополнительных факторов, таких как макроэкономические индикаторы или технические индикаторы, может улучшить качество прогноза.



#### Заключение:

Линейная регрессия показала хорошие результаты в части предсказания направления изменения цен, однако модель нуждается в улучшении для более точного предсказания цен на основе существующих данных.




## Архитектура модели с использованием **Случайные леса** (с результатами и метриками)



#### 1. **График предсказаний**


![image](https://github.com/user-attachments/assets/65f646f6-2069-4c93-be20-e717e40fb0f5)



На представленном графике видно, что модель случайных лесов (синие точки) следит за общими трендами изменения цен (красные точки), однако на некоторых участках (например, в сентябре и декабре) модель демонстрирует явные отклонения от фактических значений. Это подтверждается значительными ошибками в метриках, особенно в части предсказания абсолютных значений.



#### 2. **Метрики оценки модели**

| Метрика     | Значение        | Описание |
|-------------|-----------------|---------|
| **MSE**     | 42.8845         | Среднеквадратичная ошибка. Высокое значение MSE указывает на значительные отклонения в предсказаниях модели по сравнению с фактическими ценами. |
| **MAE**     | 3.9035          | Средняя абсолютная ошибка. В среднем модель ошибается на 3.90, что подтверждает плохую точность предсказания цен акций. |
| **R²**      | -60.8993        | Коэффициент детерминации. Отрицательное значение R² указывает на то, что модель не объясняет вариации данных и не превосходит простого наивного прогноза (например, использование предыдущего значения как предсказания). |
| **sMAPE**   | 19.33 %         | Симметричная ошибка предсказания. Модель ошибается на 19.33% в среднем, что является довольно высоким показателем для финансовых данных и указывает на низкую точность модели. |
| **MDA**     | 0.90            | Доля правильных предсказаний направления. Модель угадывает направление изменения цен в 90% случаев, что является хорошим результатом. |
| **Hit Rate**| 89.66 %         | Доля правильных предсказаний в процентах. Это также подтверждает, что модель хорошо улавливает направление движения цен. |
| **Theil U₁**| 0.1269          | Показатель, сравнивающий ошибку модели с наивным прогнозом. Значение ниже 1 указывает, что модель случайных лесов превосходит наивный прогноз, но улучшений можно ожидать. |



#### 3. **Выводы по модели**



- **Ошибки модели**: Высокие значения **MSE** и **MAE** говорят о том, что модель случайных лесов имеет значительные ошибки в предсказаниях, особенно в части предсказания абсолютных значений. В то же время, **sMAPE** (19.33%) подтверждает, что модель не идеальна в предсказаниях точных цен.

  

- **Прогноз направления**: Модель отлично справляется с предсказанием направления изменения цен, о чём свидетельствуют высокие показатели **MDA** (0.90) и **Hit Rate** (89.66%). Это говорит о том, что модель может быть полезной для задач, ориентированных на прогнозирование трендов (например, определение момента покупки или продажи).



- **Сравнение с наивной моделью**: Показатель **Theil U₁** (0.1269) указывает, что модель случайных лесов значительно лучше наивного прогноза. Хотя её точность по величине цен оставляет желать лучшего, она хорошо предсказывает направление.



#### 4. **Рекомендации для улучшения модели**

1. **Точная настройка модели**: Параметры случайного леса (например, количество деревьев или глубина деревьев) могут быть улучшены для снижения ошибки. Также можно попробовать более сложные модели, такие как градиентный бустинг (LightGBM или XGBoost).

2. **Добавление дополнительных факторов**: Можно улучшить точность модели, добавив дополнительные признаки, такие как макроэкономические индикаторы или технические индикаторы для более точного прогнозирования цен.

3. **Использование моделей с временными зависимостями**: Модели, такие как SARIMA или LSTM, могут быть более подходящими для временных рядов с явными временными зависимостями.



#### Заключение:

Модель случайных лесов имеет хорошие результаты по прогнозированию направления изменений, однако она не достаточно точна в предсказаниях абсолютных цен. Возможно, потребуется дополнительно настроить параметры модели или использовать более сложные методы для улучшения точности.




## Архитектура модели с использованием модели регрессионного дерева



### 1. Основные метрики



| Метрика | Значение            |
|---------|---------------------|
| **MSE** | 87.7583             |
| **MAE** | 5.1840              |
| **R²**  | –125.6699           |



- **MSE** и **MAE** очень высоки: средняя абсолютная ошибка более 5 единиц цены, что значительно превышает колебания акций.

- **Отрицательный R²** (–125.67) показывает, что модель работает в разы хуже наивного прогноза «без изменений».



---



### 2. Дополнительные метрики



| Метрика       | Значение    |
|---------------|-------------|
| **sMAPE**     | 30.5479 %   |
| **MDA / Hit Rate** | 0.8966  |
| **Theil U₁**  | 17.4551     |



- **sMAPE ≈ 30.5 %** указывает на огромные процентные ошибки в прогнозах.

- **MDA (Hit Rate) ≈ 89.66 %** говорит о том, что модель правильно угадывает направление изменения цены в большинстве случаев.

- **Theil U₁ ≈ 17.46** свидетельствует о катастрофической неэффективности по сравнению с наивным прогнозом (Theil U₁ = 1).



---



### 3. Характеристика графика прогнозов



![Прогноз цены акций](attachment:IMG_4198.png)



- **Май–август 2024:** дерево примерно повторяет колебания цены, хотя слегка занижает некоторые пики.

- **Сентябрь 2024:** модель еще удерживает адекватные значения.

- **Октябрь–декабрь 2024:** резкий уход прогнозов вниз, вплоть до отрицательных значений — дерево не умеет адекватно экстраполировать за пределы обучающей выборки и выдает экстремальные спуски.

- В целом:  

  - **Краткосрочно** (несколько первых точек) модель может угадывать направление,  

  - но **долгосрочные** прогнозы становятся полностью неверными.



---



### 4. Общие выводы



- **Сильные стороны:**  

  – Высокий Hit Rate (~90%) показывает, что дерево умеет улавливать направление изменений на локальном уровне.



- **Слабые стороны:**  

  – Катастрофически большие ошибки в численных прогнозах (MAE, MSE).  

  – Неспособность к адекватной экстраполяции (резкие и неверные долгосрочные спуски).  

  – Отрицательный R² и высокий Theil U₁ говорят о невменяемости прогноза для практического использования.



---



### 5. Рекомендации по улучшению



| Рекомендация                            | Описание                                                      |
|-----------------------------------------|---------------------------------------------------------------|
| **Ограничить глубину дерева**           | Уменьшить `max_depth`, чтобы избежать слишком резких спусков. |
| **Добавить больше признаков**           | Лаги, технические индикаторы, объемы, сентимент и т.п.        |
| **Использовать ансамбли**               | Random Forest или Gradient Boosting для сглаживания экстраполяции. |
| **Построить baseline**                  | Провести сравнение с «no-change» прогнозом и простыми моделями. |



Модель регрессионного дерева в текущем виде не пригодна для долгосрочного прогноза цен, но может дать представление о направлении краткосрочных движений. Для реальных торговых стратегий требуется более стабильный алгоритм и богатый признаком набор.











## **Использование глубокого обучения для временных рядов**


## Выводы по модели **RNN без регуляризации** (с результатами и метриками)



#### 1. **График предсказаний**



![image](https://github.com/user-attachments/assets/ea5e89b4-e4d4-4810-954f-7a82dfcb497d)


![image](https://github.com/user-attachments/assets/f2a40255-843e-42bc-b06d-01d1791deb98)




На графике видно, что модель **RNN без регуляризации** (синие точки) имеет значительные отклонения от фактических значений (красные точки), особенно в области прогнозирования на более долгий период (с октября по декабрь 2024 года). Это свидетельствует о слабом качестве предсказаний на более дальних промежутках, что подтверждается высокой ошибкой в метриках. Также видно, что модель "запаздывает" с предсказаниями, что может быть результатом недостаточной тренировки или неподобающей архитектуры.

#### a. **Структура модели**

Модель **RNN без регуляризации** состоит из нескольких слоёв. Вот её подробная структура:



| Слой                | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **simple_rnn**       | (None, 100, 500)        | 251,000               |
| **simple_rnn_1**     | (None, 50)              | 27,550                |
| **dense**            | (None, 25)              | 1,275                 |
| **dense_1**          | (None, 1)               | 26                    |



- **Total params**: 279,851 (1.07 MB) — общее количество параметров в модели.

- **Trainable params**: 279,851 (1.07 MB) — количество обучаемых параметров.

- **Non-trainable params**: 0 (0.00 B) — в модели нет не обучаемых параметров.



Модель состоит из двух **SimpleRNN** слоёв: первый слой содержит 500 нейронов, а второй слой — 50. После этих слоёв следует **Dense** слой с 25 нейронами и выходной слой с 1 нейроном для предсказания цен.



#### b. **График ошибок**

На втором графике видно, как модель обучается в процессе. **Тренировочная ошибка** постепенно снижается, однако **валидационная ошибка** остаётся на высоком уровне, что может указывать на переобучение модели.



#### с. **Рекомендации и улучшения**

- **Пересмотр структуры модели**: На текущем этапе модель имеет довольно высокое количество параметров (279,851), что может привести к переобучению, особенно при недостаточности данных. Следует попробовать уменьшить количество нейронов в слоях или использовать более сложные архитектуры, такие как **LSTM** или **GRU**, которые могут лучше захватывать долгосрочные зависимости в данных.

- **Добавление регуляризации**: Включение **Dropout** или **L2 регуляризации** поможет избежать переобучения и улучшить обобщающую способность модели.

- **Улучшение качества данных**: Возможно, необходимо улучшить качество данных, например, через дополнительную очистку или добавление новых признаков (например, технических индикаторов или макроэкономических факторов).

#### 2. **Метрики оценки модели**

| Метрика     | Значение           | Описание |
|-------------|--------------------|----------|
| **MSE**     | 18889.2721         | Среднеквадратичная ошибка. Высокое значение MSE указывает на значительные отклонения в предсказаниях от истинных значений. |
| **MAE**     | 104.0928           | Средняя абсолютная ошибка. В среднем модель ошибается на 104.09, что подтверждает плохую точность предсказания цен акций. |
| **R²**      | -27263.6958        | Коэффициент детерминации. Отрицательное значение указывает на то, что модель сильно хуже простого наивного прогноза (например, на основе предыдущих значений). |
| **sMAPE**   | 104.19 %           | Симметричная ошибка предсказания. Ошибка более 100% — это очень плохой результат, что говорит о неточности модели в предсказаниях. |
| **MDA**     | 0.48               | Доля правильных предсказаний направления. Модель угадывает направление изменений (вверх/вниз) только в 48% случаев, что значительно ниже ожидаемого уровня точности. |
| **Hit Rate**| 48.28 %            | Доля правильных предсказаний в процентах. Этот результат также указывает на плохую точность модели при прогнозировании направления цен. |
| **Theil U₁**| 0.7399             | Показатель Theil's U₁, сравнивающий ошибку модели с ошибкой наивного прогноза. Значение ниже 1 указывает на то, что модель всё же лучше наивного прогноза, но её точность оставляет желать лучшего. |



#### 3. **Выводы по модели**

- **Ошибка модели**: Высокие значения **MSE** и **MAE** подтверждают, что модель RNN без регуляризации не является достаточно точной. Ошибка по **sMAPE** (104.19%) указывает на очень плохую точность модели в предсказаниях цен.

- **Прогноз направления**: **MDA** (0.48) и **Hit Rate** (48.28%) показывают, что модель не достаточно хорошо предсказывает направление изменений, что является важным для задач, ориентированных на принятие торговых решений.

- **Сравнение с наивной моделью**: Несмотря на плохие результаты, показатель **Theil U₁** (0.7399) говорит о том, что модель RNN с регуляризацией всё-таки немного лучше наивного прогноза, который не принимает в расчет изменений.



#### 4. **Рекомендации для улучшения модели**

- **Регуляризация**: Рекомендуется добавить регуляризацию в модель (например, L2 или Dropout), чтобы избежать переобучения и улучшить качество предсказаний.

- **Тренировка и архитектура**: Можно провести настройку гиперпараметров модели, например, увеличить количество нейронов или слоев в сети, а также использовать более глубокие архитектуры, такие как **LSTM** или **GRU**, которые могут лучше справляться с временными зависимостями.

- **Использование дополнительных признаков**: Включение дополнительных факторов, таких как макроэкономические индикаторы или технические индикаторы, может помочь улучшить точность модели.



#### Заключение

Модель **RNN без регуляризации** показала низкую точность в предсказаниях, особенно для более длительных периодов времени. Требуется улучшение модели как в части регуляризации, так и в части архитектуры и гиперпараметров, чтобы добиться лучших результатов на временных рядах.



## Выводы по модели **RNN с DropOut**



#### 1. **Структура модели**

Модель **RNN с DropOut** состоит из нескольких слоёв. Вот её подробная структура:



| Слой                | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **simple_rnn**       | (None, 100, 500)        | 251,000               |
| **simple_rnn_1**     | (None, 50)              | 27,550                |
| **dense**            | (None, 25)              | 1,275                 |
| **dense_1**          | (None, 1)               | 26                    |



- **Total params**: 839,555 (3.20 MB) — общее количество параметров в модели.

- **Trainable params**: 279,851 (1.07 MB) — количество обучаемых параметров.

- **Non-trainable params**: 0 (0.00 B) — в модели нет не обучаемых параметров.

- **Optimizer params**: 559,704 (2.14 MB) — количество параметров, связанных с оптимизацией.



Модель использует два **SimpleRNN** слоя, каждый из которых обрабатывает последовательность данных. Включён DropOut для предотвращения переобучения, что помогает улучшить обобщающую способность модели. После этого идут два **Dense** слоя с выходом в один нейрон.



#### 2. **График ошибок**

На представленном графике видно, что после первого скачка ошибки на тренировочной выборке, **ошибка на валидационной выборке** стабилизируется. Это подтверждает, что **DropOut** помог предотвратить переобучение и улучшить обобщающую способность модели, так как валидационная ошибка остаётся низкой.



#### 3. **График предсказаний**


![image](https://github.com/user-attachments/assets/0ba426bf-7ded-43f3-bdd2-47eb644796e0)


![image](https://github.com/user-attachments/assets/93748783-9c32-4dd0-b237-561d158f9c57)





График предсказаний показывает, что модель хорошо отслеживает тенденции, но имеет большие ошибки в предсказаниях, особенно на более длительных промежутках времени. Модель не может точно предсказать значения на более долгие отрезки, что подтверждается высокими значениями ошибок в метриках.



#### 4. **Метрики модели**

| Метрика     | Значение         | Описание |
|-------------|------------------|----------|
| **MSE**     | 217.6814         | Среднеквадратичная ошибка. Значение MSE указывает на значительные отклонения предсказанных значений от реальных. |
| **MAE**     | 11.2038          | Средняя абсолютная ошибка. Модель ошибается на 11.2 по сравнению с реальными значениями. |
| **R²**      | -313.2004        | Коэффициент детерминации. Отрицательное значение свидетельствует о том, что модель значительно хуже простого наивного прогноза. |
| **sMAPE**   | 31.01 %          | Симметричная ошибка предсказания. Модель ошибается на 31.01% в среднем, что довольно много для финансовых данных. |
| **MDA**     | 0.66             | Доля правильных предсказаний направления (вверх/вниз). Модель угадывает направление в 66% случаев. |
| **Hit Rate**| 65.52 %          | Доля правильных предсказаний в процентах. Модель имеет хорошую точность в предсказаниях направления. |
| **Theil U₁**| 0.2221           | Показатель сравнения модели с наивным прогнозом. Значение ниже 1 подтверждает, что модель с DropOut лучше наивного прогноза. |



#### 5. **Заключение**

Модель **RNN с DropOut** показала, что **DropOut** помогает улучшить обобщающие способности модели, предотвращая переобучение. Тем не менее, метрики **MSE** и **MAE** показывают, что точность модели по величине предсказанных цен остаётся низкой, а **sMAPE** указывает на большую ошибку в предсказаниях.



- **Прогноз направления**: Модель хорошо предсказывает направление изменений цен (66% точности по **MDA** и 65.52% по **Hit Rate**), что является её сильной стороной.

- **Прогноз значений**: Для улучшения точности предсказаний потребуется дополнительная настройка модели, возможно, с использованием более сложных архитектур, таких как **LSTM** или **GRU**.



#### 6. **Рекомендации**:

1. Рассмотреть использование более сложных архитектур, таких как **LSTM** или **GRU**, которые более эффективно обрабатывают временные зависимости.

2. Экспериментировать с другими методами регуляризации и оптимизацией для улучшения точности прогноза.

3. Дополнительно улучшить данные, возможно, добавив дополнительные признаки или используя более частую выборку данных для тренировки.



--- 



**Выводы**:

Модель **RNN с DropOut** имеет хорошие результаты по прогнозированию направления изменений цен, но требует улучшений в точности предсказаний.



## Выводы по модели **RNN с L2-регуляризацией**



#### 1. **Структура модели**



Модель **RNN с L2-регуляризацией** состоит из нескольких слоёв. Вот её подробная структура:



| Слой                | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **simple_rnn**       | (None, 100, 500)        | 251,000               |
| **simple_rnn_1**     | (None, 50)              | 27,550                |
| **dense**            | (None, 25)              | 1,275                 |
| **dense_1**          | (None, 1)               | 26                    |



- **Total params**: 839,555 (3.20 MB) — общее количество параметров в модели.

- **Trainable params**: 279,851 (1.07 MB) — количество обучаемых параметров.

- **Non-trainable params**: 0 (0.00 B) — в модели нет не обучаемых параметров.

- **Optimizer params**: 559,704 (2.14 MB) — количество параметров, связанных с оптимизацией.



Модель использует два **SimpleRNN** слоя с L2-регуляризацией (для предотвращения переобучения) и два **Dense** слоя, где последний слой выдает предсказания для цены акций.



#### 2. **График ошибок**


![image](https://github.com/user-attachments/assets/33bc73ee-3685-4c1b-a0b9-a86df42b9dfa)


![image](https://github.com/user-attachments/assets/f61f5205-e6aa-4b97-8a85-3c549a85d236)


На втором графике видно, что после начала тренировки ошибка на **тренировочной выборке** быстро снижается, и ошибка на **валидационной выборке** стабилизируется. Это говорит о том, что L2-регуляризация эффективно помогает модели избегать переобучения, что подтверждается стабильным поведением ошибки на валидации.



#### 3. **График предсказаний**

График показывает, что модель **RNN с L2-регуляризацией** неплохо отслеживает тренды, но при этом предсказания на более поздних периодах (сентябрь-декабрь 2024 года) всё ещё имеют значительные отклонения от фактических значений. Тем не менее, предсказания модели более стабильны, чем у моделей без регуляризации.



#### 4. **Метрики модели**

| Метрика     | Значение          | Описание |
|-------------|-------------------|----------|
| **MSE**     | 86.2388           | Среднеквадратичная ошибка — показатель отклонения модели от истинных значений. В данном случае ошибка уже значительно ниже по сравнению с предыдущими моделями. |
| **MAE**     | 7.0368            | Средняя абсолютная ошибка — среднее отклонение. Модель ошибается на 7.04 в среднем. |
| **R²**      | -123.4767         | Коэффициент детерминации. Отрицательное значение указывает на то, что модель по-прежнему не объясняет вариацию данных лучше, чем наивный прогноз. |
| **sMAPE**   | 35.38 %           | Симметричная ошибка предсказания. Модель ошибается на 35.38%, что подтверждает значительные отклонения от истинных значений. |
| **MDA**     | 0.69              | Доля правильных предсказаний направления (вверх/вниз). Модель угадывает направление изменений в 69% случаев. |
| **Hit Rate**| 68.97 %           | Доля правильных предсказаний в процентах. Этот показатель также подтверждает, что модель хорошо предсказывает направление изменений, хотя и имеет свои ограничения по точности. |
| **Theil U₁**| 0.1927            | Показатель Theil's U₁, сравнивающий ошибку модели с ошибкой наивного прогноза. Модель с L2-регуляризацией работает гораздо лучше наивного прогноза. |



#### 5. **Заключение**

- **Прогноз направления**: Модель **RNN с L2-регуляризацией** достаточно хорошо предсказывает направление изменений цен (69% точности по **MDA** и 68.97% по **Hit Rate**).

- **Прогноз значений**: Хотя модель улучшила точность по сравнению с предыдущими вариантами (низкий **MSE** и **MAE**), предсказания по величине цен всё ещё имеют высокую ошибку. Это может быть связано с тем, что данные имеют высокую степень нестабильности.

- **Сравнение с наивным прогнозом**: Показатель **Theil U₁** (0.1927) указывает на то, что модель с L2-регуляризацией значительно лучше наивного прогноза, но её точность ещё требует улучшения.



#### 6. **Рекомендации**:

1. Улучшить модель можно с помощью **LSTM** или **GRU**, которые лучше захватывают долгосрочные зависимости в данных.

2. Возможно, стоит увеличить сложность модели, добавив больше слоев или нейронов в текущие слои.

3. Дополнительно улучшить данные, добавив более точные признаки или дополнительные макроэкономические индикаторы.



---



**Выводы**:

Модель **RNN с L2-регуляризацией** значительно улучшила точность предсказаний по сравнению с предыдущими моделями, но её результат всё ещё далёк от идеала. Для дальнейшего улучшения точности требуется работать над архитектурой и гиперпараметрами модели.



## Выводы по модели **CNN с BatchNormalization**



#### 1. **Структура модели**



Модель **CNN с BatchNormalization** состоит из следующих слоёв:



| Слой                | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **simple_rnn**       | (None, 100, 500)        | 251,000               |
| **simple_rnn_1**     | (None, 50)              | 27,550                |
| **dense**            | (None, 25)              | 1,275                 |
| **dense_1**          | (None, 1)               | 26                    |



- **Total params**: 839,555 (3.20 MB) — общее количество параметров в модели.

- **Trainable params**: 279,851 (1.07 MB) — количество обучаемых параметров.

- **Non-trainable params**: 0 (0.00 B) — в модели нет не обучаемых параметров.

- **Optimizer params**: 559,704 (2.14 MB) — количество параметров, связанных с оптимизацией.



Модель использует два **SimpleRNN** слоя, с добавлением **BatchNormalization** после каждого слоя для улучшения процесса обучения и стабилизации градиентов.



#### 2. **График ошибок**


![image](https://github.com/user-attachments/assets/8c0b7a5b-71d8-43a2-91f8-a16aa3e03e1f)


На представленном графике видно, что **ошибка на валидационной выборке** остаётся стабильной после начальной фазы обучения. Это говорит о том, что **BatchNormalization** помогает стабилизировать обучение и избежать переобучения, что важно для более эффективных предсказаний.



#### 3. **График предсказаний**


![image](https://github.com/user-attachments/assets/2955db03-486e-4eca-8ac6-525ee3e75455)


График предсказаний показывает, что модель **CNN с BatchNormalization** справляется с предсказаниями трендов, но предсказания всё ещё имеют значительные отклонения от фактических значений, особенно в дальнем прогнозе (сентябрь-декабрь 2024 года). Модель по-прежнему имеет высокие ошибки по величине предсказанных цен.



#### 4. **Метрики модели**

| Метрика     | Значение          | Описание |
|-------------|-------------------|----------|
| **MSE**     | 86.2388           | Среднеквадратичная ошибка. Это значение указывает на ошибку в предсказаниях модели. Оно значительно ниже по сравнению с другими моделями, что свидетельствует о лучшем качестве предсказаний. |
| **MAE**     | 7.0368            | Средняя абсолютная ошибка. Модель ошибается на 7.04 в среднем по сравнению с реальными значениями, что является хорошим результатом в контексте финансовых данных. |
| **R²**      | -123.4767         | Коэффициент детерминации. Отрицательное значение указывает на то, что модель по-прежнему плохо объясняет вариацию данных, но работает лучше наивного прогноза. |
| **sMAPE**   | 35.38 %           | Симметричная ошибка предсказания. Модель ошибается на 35.38%, что довольно много для финансовых данных, но является улучшением по сравнению с предыдущими подходами. |
| **MDA**     | 0.69              | Доля правильных предсказаний направления (вверх/вниз). Модель угадывает направление изменений в 69% случаев, что является хорошим результатом. |
| **Hit Rate**| 68.97 %           | Доля правильных предсказаний в процентах. Модель даёт хороший результат в предсказаниях направления. |
| **Theil U₁**| 0.1927            | Показатель сравнения модели с наивным прогнозом. Значение ниже 1 указывает на то, что модель с **BatchNormalization** работает значительно лучше наивного прогноза. |



#### 5. **Заключение**

- **Прогноз направления**: Модель **CNN с BatchNormalization** достаточно хорошо предсказывает направление изменений цен (69% точности по **MDA** и 68.97% по **Hit Rate**).

- **Прогноз значений**: Несмотря на улучшение по меткам **MSE** и **MAE**, предсказания по величине цен всё ещё имеют значительные отклонения. Для улучшения точности требуется дополнительная настройка модели.

- **Сравнение с наивным прогнозом**: Показатель **Theil U₁** (0.1927) подтверждает, что модель с **BatchNormalization** значительно лучше наивного прогноза.



#### 6. **Рекомендации**:

1. Для дальнейшего улучшения точности предсказаний можно использовать более сложные архитектуры, такие как **LSTM** или **GRU**, которые лучше справляются с долгосрочными зависимостями в данных.

2. Экспериментировать с другими методами регуляризации, такими как **L2** или **Dropout**.

3. Улучшить данные, например, добавив дополнительные признаки или более частые выборки для тренировки модели.



---



**Выводы**:

Модель **CNN с BatchNormalization** показала хорошие результаты по прогнозированию направления изменений цен, но требует улучшения точности предсказаний цен.




## Выводы по модели **LSTM без регуляризации**

#### 1. **Структура модели**

Модель **LSTM без регуляризации** состоит из нескольких слоёв, представленных ниже:

| Слой | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **lstm** | (None, 100, 500) | 1,004,000 |
| **lstm_1** | (None, 50) | 110,200 |
| **dense_8** | (None, 25) | 1,275 |
| **dense_9** | (None, 1) | 26 |

- **Total params**: 1,115,501 (4.26 MB) — общее количество параметров в модели.
- **Trainable params**: 1,115,501 (4.26 MB) — все параметры модели обучаемы.
- **Non-trainable params**: 0 (0.00 B) — нет не обучаемых параметров.

Модель использует два **LSTM** слоя для захвата временных зависимостей в данных и два **Dense** слоя для вывода прогноза.

#### 2. **График ошибок**


![image](https://github.com/user-attachments/assets/d3f25180-f32b-42da-8d89-adbe46a357b3)



На графике видно, что **ошибка на валидационной выборке** в модели **LSTM без регуляризации** колеблется на протяжении тренировочного процесса, что может свидетельствовать о сложности модели или недостаточном обучении. Однако ошибка на **тренировочной выборке** быстро снижается, что означает, что модель учится на тренировочных данных.

#### 3. **График предсказаний**


![image](https://github.com/user-attachments/assets/4caff590-2395-4840-981e-b2b5d1b3bb4a)


График предсказанных значений показывает, что модель **LSTM без регуляризации** не так хорошо отслеживает реальные данные, особенно в более поздние периоды (сентябрь-декабрь 2024 года). Это указывает на проблемы с генерализацией модели, которые, возможно, можно улучшить с помощью регуляризации.

#### 4. **Метрики модели**
| Метрика | Значение | Описание |
|-------------|-------------------|----------|
| **MSE** | 697.2388 | Среднеквадратичная ошибка — большая ошибка, указывающая на высокие отклонения предсказаний от фактических значений. |
| **MAE** | 20.0871 | Средняя абсолютная ошибка — показывает, что модель ошибается на 20.09 в среднем. Это довольно высокая ошибка для финансовых предсказаний. |
| **R²** | -1005.3900 | Коэффициент детерминации, который показывает, что модель не объясняет вариацию данных. |
| **sMAPE** | 98.57 % | Симметричная ошибка предсказания — модель ошибается на 98.57%, что указывает на серьёзные отклонения. |
| **MDA** | 0.55 | Доля правильных предсказаний направления (вверх/вниз). Модель угадывает направление в 55% случаев. |
| **Hit Rate**| 55.17 % | Доля правильных предсказаний в процентах. Модель даёт результат чуть выше случайного угадывания. |
| **Theil U₁**| 0.5739 | Показатель Theil’s U₁, который указывает на то, что модель работает значительно хуже наивного прогноза. |

#### 5. **Заключение**
- **Прогноз направления**: Модель **LSTM без регуляризации** угадывает направление изменений с точностью 55% (**MDA** = 0.55), что ближе к случайному угадыванию.
- **Прогноз значений**: Модель имеет очень высокие ошибки (в **MSE** и **MAE**), что указывает на необходимость улучшений, например, через регуляризацию или изменение архитектуры модели.
- **Сравнение с наивным прогнозом**: Показатель **Theil U₁** (0.5739) подтверждает, что модель **LSTM без регуляризации** работает хуже наивного прогноза, и требуется значительная настройка для улучшения её производительности.

#### 6. **Рекомендации**:
1. **Регуляризация**: Добавить регуляризацию (например, **Dropout** или **L2-регуляризацию**), чтобы избежать переобучения.
2. **Архитектура модели**: Экспериментировать с количеством слоёв и нейронов в слоёв LSTM.
3. **Гиперпараметры**: Тщательная настройка гиперпараметров, включая размер последовательности и размер мини-батча, для улучшения обобщающей способности модели.
4. **Данные**: Использование большего объема данных и дополнительных признаков для улучшения точности предсказаний.

---


**Выводы**: Модель **LSTM без регуляризации** требует улучшений в архитектуре и регуляризации для достижения более точных предсказаний.




## Выводы по модели **LSTM с Dropout**

#### 1. **Структура модели**

Модель **LSTM с Dropout** состоит из нескольких слоёв, представленных ниже:

| Слой | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **lstm_2** | (None, 100, 500) | 1,004,000 |
| **lstm_3** | (None, 50) | 110,200 |
| **dense_10** | (None, 25) | 1,275 |
| **dense_11** | (None, 1) | 26 |

- **Total params**: 1,115,501 (4.26 MB) — общее количество параметров в модели.
- **Trainable params**: 1,115,501 (4.26 MB) — все параметры обучаемы.
- **Non-trainable params**: 0 (0.00 B) — нет не обучаемых параметров.

Модель использует два **LSTM** слоя для захвата временных зависимостей в данных и два **Dense** слоя для вывода прогноза. Также использован **Dropout** для предотвращения переобучения.

#### 2. **График ошибок**


![image](https://github.com/user-attachments/assets/53f2a2df-b6b5-4f24-b0e0-babf7339d63e)


На графике видно, что **ошибка на валидационной выборке** в модели **LSTM с Dropout** значительно снизилась по сравнению с предыдущими моделями, что свидетельствует о хорошем обучении и уменьшении переобучения.

#### 3. **График предсказаний**


![image](https://github.com/user-attachments/assets/606eb576-ea30-4e68-96a2-06e8d9c44bef)


График предсказанных значений показывает, что модель **LSTM с Dropout** теперь гораздо точнее отслеживает реальные данные. Особенно заметен хороший результат в периодах с высокой изменчивостью.

#### 4. **Метрики модели**
| Метрика | Значение | Описание |
|-------------|------------------|----------|
| **MSE** | 1.4762 | Среднеквадратичная ошибка — показывает, что модель достаточно хорошо предсказывает значения с низким отклонением. |
| **MAE** | 0.9788 | Средняя абсолютная ошибка — измеряет среднее отклонение, что также подтверждает хорошую точность модели. |
| **R²** | -1.1307 | Коэффициент детерминации, который показывает, что модель в целом объясняет вариацию данных, хотя результат немного хуже, чем для идеальной модели. |
| **sMAPE** | 3.51 % | Симметричная ошибка предсказания — модель имеет высокую точность, с минимальной ошибкой. |
| **MDA** | 0.97 | Доля правильных предсказаний направления (вверх/вниз). Очень хороший результат. |
| **Hit Rate**| 96.55 % | Доля правильных предсказаний в процентах. Модель даёт очень высокие результаты, близкие к идеальным. |
| **Theil U₁**| 0.0221 | Показатель Theil’s U₁, который указывает, что модель работает значительно лучше наивного прогноза. |

#### 5. **Заключение**
- **Прогноз направления**: Модель **LSTM с Dropout** угадывает направление изменений с точностью в 97% (**MDA** = 0.97), что является отличным результатом.
- **Прогноз значений**: Модель показала отличные результаты по **MSE**, **MAE** и **sMAPE**, что указывает на высокую точность предсказаний по величине.
- **Сравнение с наивным прогнозом**: Показатель **Theil U₁** (0.0221) подтверждает, что модель **LSTM с Dropout** значительно лучше наивного прогноза.

#### 6. **Рекомендации**:
1. Модель уже даёт отличные результаты, однако можно продолжить улучшение, экспериментируя с гиперпараметрами (например, количеством нейронов или слоёв).
2. Оценить влияние других методов регуляризации (например, **L2-регуляризации**) для дальнейшего повышения стабильности модели.
3. Рассмотреть возможность увеличения объёма тренировочных данных для ещё более точных предсказаний.

---


**Выводы**: Модель **LSTM с DropOut** показывает отличные результаты по предсказаниям направления изменений цен, а также по точности самих предсказаний.




## Выводы по модели **LSTM с L2-регуляризацией**



#### 1. **Структура модели**

Модель **LSTM с L2-регуляризацией** состоит из нескольких слоёв, представленных ниже:



| Слой                | Размер выходных данных | Количество параметров |
|---------------------|------------------------|-----------------------|
| **lstm_4**          | (None, 100, 500)        | 1,004,000             |
| **lstm_5**          | (None, 50)              | 110,200               |
| **dense_12**        | (None, 25)              | 1,275                 |
| **dense_13**        | (None, 1)               | 26                    |



- **Total params**: 1,115,501 (4.26 MB) — общее количество параметров в модели.

- **Trainable params**: 1,115,501 (4.26 MB) — все параметры обучаемы.

- **Non-trainable params**: 0 (0.00 B) — нет не обучаемых параметров.



Модель использует два **LSTM** слоя для захвата временных зависимостей в данных, два **Dense** слоя для вывода прогноза, а также **L2-регуляризацию** для предотвращения переобучения.



#### 2. **График ошибок**



![image](https://github.com/user-attachments/assets/20bdd422-ae37-4361-8d0f-e6d70eb73666)




График ошибок показывает, что **LSTM с L2-регуляризацией** достаточно быстро обучается и на валидационной выборке ошибка остаётся на низком уровне, что подтверждает эффективность регуляризации в предотвращении переобучения.



#### 3. **График предсказаний**


![image](https://github.com/user-attachments/assets/8e56536d-c4d2-4bba-b72b-a17e8bd4b8c7)



График показывает, что модель достаточно точно предсказывает значения с минимальными отклонениями от истинных данных, особенно в периодах с меньшей изменчивостью.



#### 4. **Метрики модели**



| Метрика     | Значение         | Описание |
|-------------|------------------|----------|
| **MSE**     | 68.8261          | Среднеквадратичная ошибка. Указывает на хорошее приближение предсказанных значений к истинным. |
| **MAE**     | 6.3005           | Средняя абсолютная ошибка. Показатель отклонения предсказанных значений от истинных. |
| **R²**      | -98.3433         | Коэффициент детерминации. Результат указывает на то, что модель объясняет малую часть вариации в данных, что требует внимания. |
| **sMAPE**   | 19.58 %          | Симметричная ошибка предсказания. Указывает на высокую точность модели, особенно с учётом регуляризации. |
| **MDA**     | 0.72             | Доля правильных предсказаний направления. Очень хороший результат, модель точно угадывает направление изменений. |
| **Hit Rate**| 72.41 %          | Доля правильных предсказаний. Указывает на хорошее совпадение с реальными данными. |
| **Theil U₁**| 0.1364           | Показатель Theil’s U₁. Очень хороший результат, модель работает значительно лучше, чем наивный прогноз. |



#### 5. **Заключение**

- **Прогноз направления**: Модель **LSTM с L2-регуляризацией** показывает хороший результат в 72% (**Hit Rate**) по правильным предсказаниям направления изменений цен.

- **Прогноз значений**: Модель демонстрирует отличную точность по метрикам **MSE**, **MAE**, **sMAPE**, что подтверждает её эффективность в предсказании значений.

- **Сравнение с наивным прогнозом**: Показатель **Theil U₁** (0.1364) подтверждает, что модель значительно превосходит наивный прогноз по качеству предсказаний.



#### 6. **Рекомендации**:

1. **Модель уже даёт отличные результаты**. Следует продолжить экспериментировать с гиперпараметрами для возможного улучшения.

2. **Снижение значения R²**: Для повышения объяснённой дисперсии можно попробовать увеличить тренировочные данные или изменить архитектуру сети.

3. **Эксперименты с другими регуляризаторами** (например, **DropOut** или **BatchNormalization**) могут дополнительно улучшить стабильность модели.



---






**Выводы**: Модель **LSTM с L2-регуляризацией** продемонстрировала высокую точность в предсказаниях с минимальными ошибками и хорошими показателями по прогнозу направления изменений цен.




## Архитектура модели с использованием LSTM и BatchNormalization



В данной модели используется несколько слоев LSTM (Long Short-Term Memory) и BatchNormalization, а также полносвязные слои (Dense). Вот подробное описание каждого слоя:



| Слой (тип)                       | Выходная форма         | Количество параметров |
|-----------------------------------|------------------------|-----------------------|
| **lstm_6 (LSTM)**                 | (None, 100, 500)       | 1,004,000             |
| **batch_normalization_3**         | (None, 100, 500)       | 2,000                 |
| **lstm_7 (LSTM)**                 | (None, 50)             | 110,200               |
| **batch_normalization_4**         | (None, 50)             | 200                   |
| **dense_14 (Dense)**              | (None, 25)             | 1,275                 |
| **batch_normalization_5**         | (None, 25)             | 100                   |
| **dense_15 (Dense)**              | (None, 1)              | 26                    |
| **Итого**                         |                        | **1,117,801** (4.26 MB) |



- **Общее количество параметров** модели: 1,117,801 (4.26 МБ).

- **Тренируемые параметры**: 1,116,651 (4.26 МБ).

- **Нетренируемые параметры**: 1,150 (4.49 КБ).



### Описание графиков


![image](https://github.com/user-attachments/assets/68550f61-f6ff-4911-a2c3-072fab0fd53b)



**График 1: Истинные и предсказанные значения цен акций**

   - На первом графике показаны истинные значения цен акций (красные точки) и предсказанные значения (синие точки). 

   - **Ось X** отображает дальность прогноза в днях (с мая 2024 года по декабрь 2024 года).

   - **Ось Y** показывает цену акции.

   - Визуально можно заметить, что предсказания модели (синие точки) значительно отличаются от истинных значений (красные точки), что указывает на плохую точность модели в предсказании цен. Модель не справляется с задачей предсказания величины, хотя, возможно, корректно предсказывает направление изменений.



![image](https://github.com/user-attachments/assets/fe120e81-e361-4b55-a74b-2202bec13aac)


**График 2: Ошибка модели по эпохам (LSTM с BatchNormalization)**

   - Второй график показывает изменение ошибки модели по эпохам для тренировки (синий график) и валидации (оранжевый график).

   - **Ось X** отображает количество эпох обучения.

   - **Ось Y** показывает ошибку модели.

   - На графике видно, что ошибка на тренировочной выборке значительно ниже, чем на валидационной. Это может свидетельствовать о **переобучении** модели, так как модель идеально обучается на тренировочных данных, но не способна адекватно обобщать на новых данных (валидационных).

   - Ошибка на валидационной выборке сильно колеблется, что также указывает на нестабильность и неполную сходимость модели.



Выводы:

- **График 1** демонстрирует, что модель не справляется с точным предсказанием цен акций.

- **График 2** указывает на возможное переобучение модели, поскольку она показывает низкую ошибку на тренировочной выборке, но значительно более высокую на валидационной.

- Для улучшения результатов необходимо работать над стабилизацией модели, возможно, путем дополнительной регуляризации или изменения архитектуры модели.



### Метрики оценки модели



| Метрика                      | Значение                |
|------------------------------|-------------------------|
| **MSE (Среднеквадратическая ошибка)**  | 58,491.77              |
| **MAE (Средняя абсолютная ошибка)**   | 188.20                 |
| **R² (Коэффициент детерминации)**      | -84,425.77             |
| **sMAPE (Symmetric Mean Absolute Percentage Error)** | 126.05%               |
| **MDA (Mean Directional Accuracy)**    | 0.93                   |
| **Hit Rate**                    | 0.93                   |
| **Theil U₁**                    | 0.63                   |



1. **Среднеквадратическая ошибка (MSE)**: 58,491.77  

   Это значение представляет собой среднюю квадратичную ошибку между предсказанными и реальными значениями. Высокие значения MSE могут указывать на наличие значительных отклонений в предсказаниях.



2. **Средняя абсолютная ошибка (MAE)**: 188.20  

   MAE показывает среднее абсолютное отклонение предсказанных значений от истинных. Значение 188.20 говорит о том, что модель в среднем ошибается на 188.20 единиц в предсказаниях.



3. **Коэффициент детерминации (R²)**: -84,425.77  

   R² показывает, насколько хорошо модель объясняет вариацию данных. Отрицательное значение R² указывает на то, что модель не подходит для данного набора данных и хуже простого среднего предсказания.



4. **Symmetric Mean Absolute Percentage Error (sMAPE)**: 126.05%  

   Эта метрика измеряет точность модели, где более низкие значения показывают более точные предсказания. Значение 126.05% является довольно высоким и указывает на слабую производительность модели.



5. **Mean Directional Accuracy (MDA)**: 0.93  

   MDA показывает процент правильных направлений в предсказаниях модели (если направление изменения цены совпадает с реальным). Значение 0.93 говорит о том, что модель верно предсказывает направление изменений 93% времени.



6. **Hit Rate**: 0.93  

   Эта метрика аналогична MDA и указывает на процент точных предсказаний. Значение 0.93 также подтверждает, что модель правильно предсказывает результаты на 93%.



7. **Theil U₁**: 0.63  

   Theil U₁ является показателем, который измеряет отклонение модели от идеальных предсказаний. Значение 0.63 говорит о том, что модель не достигает идеальных результатов, но все же дает полезные предсказания.



### Выводы:



**Модель не достигает хороших результатов по большинству метрик**, особенно в плане точности предсказаний (MSE, MAE, sMAPE). Отрицательный R² и высокое значение sMAPE указывают на необходимость улучшений в архитектуре или данных.

   

**Хорошие результаты в направлении предсказаний**: MDA и Hit Rate равны 93%, что говорит о том, что модель может успешно предсказывать направление изменения цен, хотя и не всегда точна в величине.


**Возможные улучшения**: Возможно, модель стоит доработать, применив другие методы предобработки данных, улучшение выбора признаков или регуляризацию для уменьшения ошибок.





## Архитектура модели с использованием Seq2Seq с Attention



| Слой (тип)                        | Выходная форма                   | Параметров |
|------------------------------------|----------------------------------|------------|
| **input_layer_8**<br>(InputLayer)  | (None, 100, 1)                   | 0          |
| **lstm_8**<br>(LSTM)               |  
- Последовательность: (None, 100, 128)  
- Состояния: (None, 128), (None, 128) | 66 560     |
| **input_layer_9**<br>(InputLayer)  | (None, 100, 1)                   | 0          |
| **attention_layer**<br>(AttentionLayer) |  
- Контекст: (None, 128)  
- Веса внимания: (None, 100, 1)      | 32 896     |
| **lstm_9**<br>(LSTM)               |  
- Последовательность: (None, 100, 128)  
- Состояния: (None, 128), (None, 128) | 66 560     |
| **context_layer**<br>(ContextLayer)| (None, 100, 128)                 | 0          |
| **concatenate**<br>(Concatenate)   | (None, 100, 256)                 | 0          |
| **dense_16**<br>(Dense)            | (None, 100, 1)                   | 257        |
|                                    | **Итого**                        | **166 273**|



---



### Метрики оценки модели Seq2Seq+Attention



| Метрика                                                      | Значение        |
|--------------------------------------------------------------|-----------------|
| **MSE** (Mean Squared Error)                                 | 789.59          |
| **MAE** (Mean Absolute Error)                                | 21.43           |
| **R²** (коэффициент детерминации)                            | −1 138.68       |
| **sMAPE** (Symmetric MAPE)                                   | 101.67 %        |
| **MDA** (Mean Directional Accuracy)                          | 0.5517          |
| **Hit Rate**                                                 | 0.5517          |
| **Theil U₁**                                                 | 0.6036          |



---



### Расшифровка графиков


![image](https://github.com/user-attachments/assets/c174a083-524e-4ae7-90c2-21277d7e5dd4)



1. **Истинные vs предсказанные значения (график 1)**  

   - **Ось X**: дальность прогноза в днях (с мая по декабрь 2024).  

   - **Ось Y**: цена акции.  

   - **Красные точки**: реальные («истинные») цены, которые колеблются в диапазоне ~26–29.  

   - **Синие точки**: предсказанные моделью значения. Сначала слегка ниже реальных, но затем предсказания стремительно падают, уходят в ноль и отрицательные значения.  

   - **Вывод**: модель не удерживает уровень реальных цен и даёт значимые расхождения, особенно на длинных горизонтах.



![image](https://github.com/user-attachments/assets/83e225a5-772c-4e55-b822-51b4bd5bc6db)



2. **Ошибка по эпохам (график 2)**  

   - **Ось X**: номер эпохи обучения (0…199).  

   - **Ось Y**: значение функции потерь (MSE на нормализованных данных).  

   - **Синяя линия**: ошибка на **тренировочной** выборке. Быстро падает с ~0.08 до ~0.005 и затем медленно снижается к ~0.0055.  

   - **Оранжевая линия**: ошибка на **валидационной** выборке. После первой эпохи спадает с ~0.02 до ~0.011, потом стабильно держится в диапазоне ~0.010–0.012.  

   - **Вывод**: модель сходится, но между тренировочной и валидационной кривыми есть разрыв (~2×), что намекает на лёгкое переобучение или недостаточную регуляризацию.



---



### Общие выводы и рекомендации



- **Абсолютная точность**: MAE ≈ 21 лучше, чем в чистой LSTM (≈188), но всё ещё слишком большое смещение для практического использования.  

- **R² сильно отрицателен**: модель хуже простой прогноза средним значением.  

- **Направление движения**: MDA ≈ 55 % чуть лучше случайного, но недостаточно надёжно.  

- **Процентная ошибка**: sMAPE > 100 % подтверждает высокую неточность предсказаний по величине.  

- **Theil U₁ ≈ 0.60** — средний результат, далеко от идеала.  



**Рекомендации по улучшению**:  

- Добавить регуляризацию (Dropout, L2), раннюю остановку (EarlyStopping) или усложнить механизм внимания (multi-head).  

- Применить teacher forcing/​scheduled sampling при обучении декодера.  

- Расширить набор входных признаков (технические и фундаментальные индикаторы).  

- Разделить горизонты прогноза: короткие (Seq2Seq) и долгие (статические тренды или ARIMA).





## Архитектура модели с использованием AutoML



| Метрика | Значение |
|---------|----------|
| MSE     | 0.3157   |
| MAE     | 0.4190   |
| R²      | -0.0219  |



### 1. Вывод по основным метрикам 

- **MSE** и **MAE** довольно высоки относительно масштаба данных. Средняя абсолютная ошибка (МАЕ ≈ 0.419) предполагает, что модель ошибается в среднем примерно на ±0.42 единицы цены.

- Метрика **R² ≈ -0.0219** отрицательна, это говорит о том, что модель не смогла объяснить вариацию данных лучше, чем простое среднее значение (наивная модель). В таких случаях обычно говорят, что модель хуже, чем базовый наивный прогноз.



---



### 2. Дополнительные метрики



| Дополнительная метрика | Значение |
|------------------------|----------|
| sMAPE                  | 6.853 %  |
| MDA (Hit Rate)         | 0.8621   |
| Theil U₁               | 4.8829   |



**Вывод по дополнительным метрикам:**  

- **sMAPE (6.85%)** выглядит приемлемо, свидетельствует о средней процентной ошибке модели относительно истинных значений.

- **MDA / Hit Rate (86.21%)** — превосходный показатель. Модель довольно точно улавливает направление изменения цен, что очень полезно для торговли.

- Однако, **Theil U₁ = 4.8829**, значительно больше единицы. Это указывает на то, что модель прогнозирует хуже, чем простой прогноз «цена завтра такая же, как сегодня». Значение выше 1 свидетельствует о серьезных проблемах модели на численных прогнозах цены.



---



### 3. Анализ графика прогнозов и реальных значений



![image](https://github.com/user-attachments/assets/e615a077-716b-4347-8113-eaefd9f4f9f6)





На графике представлены реальные значения акций (красным) и предсказанные значения (синим):



| Период прогноза           | Направление движения (реальные данные) | Направление движения (прогноз) | Согласованность направления |
|---------------------------|----------------------------------------|--------------------------------|------------------------------|
| Май-июнь 2024             | Понижение                               | Понижение                      | ✔️                           |
| Июнь-июль 2024            | Боковое движение                        | Понижение                      | ±                            |
| Июль-август 2024          | Повышение                               | Повышение                      | ✔️                           |
| Август-сентябрь 2024      | Понижение                               | Повышение                      | ✘                            |
| Сентябрь-октябрь 2024     | Понижение                               | Боковое                        | ±                            |
| Октябрь-декабрь 2024      | Понижение                               | Повышение                      | ✘                            |



**Анализ визуального поведения графика:**  

- С мая по июль 2024 модель достаточно хорошо следует общей тенденции цены.  

- Начиная с августа модель начинает резко расходиться с реальными значениями, сильно завышая прогнозируемую цену.

- Наиболее значительное расхождение происходит в сентябре-ноябре 2024 года. Это говорит о том, что модель недостаточно учитывает возможные переломы тренда и завышает долгосрочные ожидания относительно цены.



**Возможные причины расхождений:**  

- Отсутствие достаточного количества признаков (например, лагов или индикаторов) для улавливания переломов тренда.

- Слишком простая модель (линейная GLM-модель), возможно, не способная улавливать нелинейные закономерности.



---



### 4. Таблица важности признаков модели GLM



| Переменная | Относительная важность | Нормированная важность | Процент вклада |
|------------|------------------------|------------------------|----------------|
| Quarter    | 0.1597                 | 1.000                  | 52.39%         |
| Month_num  | 0.1428                 | 0.8947                 | 46.87%         |
| Year       | 0.0023                 | 0.0142                 | 0.75%          |



**Вывод:**  

- Главный вклад в прогнозируемое значение вносит квартал (Quarter) и номер месяца (Month_num). Переменная Year практически незначима.

- Недостаточное разнообразие признаков и чрезмерная зависимость от календарных признаков (Quarter, Month_num) могут быть причиной низкого качества прогноза.



---



### 5. Общие выводы по модели и рекомендации



**Сильные стороны:**  

- Модель хорошо предсказывает направление изменения цены (направление движения акций предсказывается верно в ~86% случаев).



**Слабые стороны:**  

- Очень низкое качество прогноза по численным показателям (MSE, MAE, R², Theil U₁).

- Модель неэффективна в прогнозировании точных значений цены акций.



### Причины низкого качества:

- Использование только календарных признаков (без ценовых лагов, технических и фундаментальных индикаторов).

- Простота лидирующей модели (GLM – линейная модель), не учитывающая нелинейные зависимости и резкие изменения тренда.



---



### 6. Рекомендации по улучшению прогноза:

| Рекомендация                                   | Описание                                                                                               |
|------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| **Добавление лаговых признаков**               | Включите предыдущие значения цен (`Close`, `Diff`) для учета временной структуры данных                |
| **Использование технических индикаторов**      | RSI, MACD, скользящие средние помогут улавливать переломные моменты и тренды                           |
| **Интеграция фундаментальных показателей**     | Макроэкономические показатели и новостные сентименты улучшат понимание общей ситуации рынка            |
| **Использование более сложных моделей**        | LightGBM, XGBoost или нейросети смогут уловить нелинейные закономерности лучше, чем линейные модели    |
| **Настройка AutoML**                           | Увеличьте время поиска, разрешите использовать ensemble-модели и более сложные архитектуры             |



---



### Итоговый вывод по текущей модели:

Модель показала хорошие результаты только в направлении движения цены (86% точности по направлению). Однако точность численных прогнозов недостаточна для торговых решений, так как она проигрывает даже наивной модели. Необходимы доработки с расширением признакового пространства и использованием более мощных нелинейных алгоритмов прогнозирования.





## Архитектура модели с использованием модели TPOT (XGBoost)



---



### 1. Основные метрики модели TPOT



| Метрика | Значение |
|---------|----------|
| MSE     | 18.3629  |
| MAE     | 3.2462   |
| R²      | -5.6262  |



**Вывод по основным метрикам:**  

- Модель TPOT продемонстрировала крайне низкую эффективность по основным метрикам. Значение **R² отрицательно (-5.6262)** и говорит о том, что модель значительно хуже, чем наивный прогноз. Высокие значения **MSE и MAE** также свидетельствуют о большом отклонении прогнозных значений от истинных.



---



### 2. Дополнительные метрики модели TPOT



| Дополнительная метрика | Значение |
|------------------------|----------|
| sMAPE                  | 11.2570 %|
| MDA (Hit Rate)         | 0.8966   |
| Theil U₁               | 3.9924   |



**Вывод по дополнительным метрикам:**  

- **sMAPE (11.257%)** — средняя абсолютная процентная ошибка несколько выше по сравнению с предыдущими моделями. Это значит, что процентные отклонения прогнозов стали больше.

- Метрики направления (**MDA/Hit Rate = 0.8966**) впечатляют, модель предсказывает направление движения цены почти в 90% случаев. Это очень хороший результат для трейдинга.

- Однако, значение **Theil U₁ = 3.9924** намного выше единицы, что говорит о неэффективности модели по сравнению с наивным прогнозом.



---



### 3. Анализ графика модели TPOT (XGBoost)


![image](https://github.com/user-attachments/assets/a1f069ff-8d2d-4487-b2cb-8ced8edba470)




График демонстрирует динамику истинных и прогнозируемых значений:



| Период прогноза           | Реальное движение цены | Прогноз движения цены | Совпадение |
|---------------------------|------------------------|-----------------------|------------|
| Май-июнь 2024             | Понижение              | Понижение             | ✔️         |
| Июнь-июль 2024            | Боковое / слабое понижение | Понижение         | ✔️         |
| Июль-август 2024          | Повышение              | Повышение             | ✔️         |
| Август-сентябрь 2024      | Понижение              | Повышение             | ✘          |
| Сентябрь-октябрь 2024     | Понижение              | Повышение             | ✘          |
| Октябрь-декабрь 2024      | Понижение              | Повышение             | ✘          |



### Характеристики графика:

- **Первая половина периода (май-август):** Модель неплохо повторяет форму графика реальных цен, улавливая тренды (понижение и повышение).

- **Вторая половина периода (с августа по декабрь):** происходит значительное расхождение между реальными и прогнозируемыми значениями. Прогноз стабильно завышен и игнорирует чётко выраженный нисходящий тренд реальных цен.

- Таким образом, несмотря на хороший прогноз направления движения в краткосрочной перспективе, модель полностью теряет способность прогнозировать перелом тренда и значительные ценовые движения в долгосрочном горизонте.



---



### 4. Особенности конвейера TPOT (XGBoost)



TPOT выбрал следующую модель:



```python

Pipeline(steps=[
    ('normalizer', Normalizer()),
    ('xgbregressor', XGBRegressor(
        learning_rate=0.01,
        max_depth=6,
        min_child_weight=16,
        n_estimators=100,
        random_state=42
    ))
])

```



**Вывод:**  

- Использована мощная модель XGBoost, но даже она не смогла показать хороший результат, что говорит о том, что возможно проблема в недостатке информативных признаков.

- Возможно, данные нуждаются в более тщательной обработке или дополнительной инженерии признаков (технические индикаторы, лаги цен, внешние данные).




---



### 5. Итоговые выводы по модели TPOT (XGBoost)



**Сильные стороны TPOT:**

- Высокая точность в предсказании направления цены (почти 90%).



**Слабые стороны TPOT:**

- Неприемлемо высокий уровень ошибок (MAE, MSE).

- Неспособность предсказать перелом тренда и значительные изменения цен.

- Очень низкий коэффициент детерминации (отрицательный R²).



---



### 6. Рекомендации по улучшению TPOT-модели:



| Рекомендация                           | Описание                                             |
|----------------------------------------|------------------------------------------------------|
| Добавить лаговые признаки              | Лаги и скользящие средние позволят учитывать тренды  |
| Применить технические индикаторы       | RSI, MACD, Bollinger Bands помогут улавливать сигналы|
| Использовать фундаментальные признаки  | Макроэкономические индексы и новости улучшат прогноз |
| Увеличить число поколений TPOT         | Повысит вероятность подбора более подходящей модели  |
| Добавить больше данных                 | Более длинная история поможет модели учесть циклы    |



---



### Итоговый вывод:

TPOT (XGBoost) хорошо предсказывает направление движения, но полностью теряет точность на численном прогнозе, особенно в долгосрочном горизонте. Модель требует значительного улучшения и тщательной инженерии признаков. Без этого она проигрывает простой линейной модели AutoML по большинству важных численных метрик.





## Архитектура модели с использованием модели Prophet






### 1. Основные метрики Prophet:



| Метрика | Значение |
|---------|----------|
| MSE     | 3.2868   |
| MAE     | 1.4602   |
| R²      | -3.7441  |



**Вывод по основным метрикам:**  

- Метрика **MSE = 3.2868** и **MAE = 1.4602** относительно высоки для задачи прогнозирования цен акций, что указывает на значительные ошибки прогнозирования.

- Коэффициент детерминации **R² ≈ -3.7441** существенно ниже нуля. Это говорит о плохой способности модели объяснять вариативность в данных.



---



### 2. Дополнительные метрики Prophet:



| Дополнительная метрика | Значение |
|------------------------|----------|
| sMAPE                  | 5.4696 % |
| MDA (Hit Rate)         | 0.7241   |
| Theil U₁               | 3.3666   |



**Вывод по дополнительным метрикам:**  

- **sMAPE (5.4696%)** — относительно невысокая процентная ошибка, свидетельствующая о приемлемом среднем отклонении в процентах.

- **Hit Rate / MDA (72.41%)** — умеренно высокий показатель, модель правильно предсказывает направление примерно в 72% случаев, что хорошо, но ниже результатов предыдущих моделей.

- **Theil U₁ (3.3666)** значительно выше единицы, следовательно, модель Prophet менее эффективна, чем простой наивный прогноз.



---



### 3. Анализ графика прогнозов Prophet:



![image](https://github.com/user-attachments/assets/1055fbad-6920-4ee5-97d8-da0e47d36c70)



### Оценка поведения модели по периодам прогноза:



| Период прогноза           | Реальное движение цены | Прогноз движения цены | Совпадение |
|---------------------------|------------------------|-----------------------|------------|
| Май-июнь 2024             | Понижение              | Понижение             | ✔️         |
| Июнь-июль 2024            | Боковое / небольшое понижение | Сильное понижение | ✔️±        |
| Июль-август 2024          | Повышение              | Боковое движение      | ✘          |
| Август-сентябрь 2024      | Понижение              | Повышение             | ✘          |
| Сентябрь-октябрь 2024     | Понижение              | Понижение             | ✔️         |
| Октябрь-декабрь 2024      | Понижение              | Повышение             | ✘          |



### Общая характеристика графика:

- В первые месяцы (май-июль) Prophet достаточно успешно отслеживает тренд цены акций.

- Модель Prophet сильно отклоняется от реальных значений начиная с августа, когда не предсказывает корректно рост цены и последующее снижение. Вместо этого она дает резкие колебания, теряя точность.

- Во второй половине периода (сентябрь-декабрь) график Prophet заметно отклоняется вверх, игнорируя нисходящий тренд в реальных данных, что и приводит к высоким значениям метрик ошибок (MSE, MAE).



---





### 4. Общие выводы по Prophet:



**Сильные стороны Prophet:**

- Простота модели и интерпретируемость.

- Относительно низкая процентная ошибка (sMAPE).



**Слабые стороны Prophet:**

- Низкое качество прогноза абсолютных значений (высокий MAE, MSE, отрицательный R²).

- Недостаточная способность прогнозировать изменение трендов (Hit Rate ниже, чем у других моделей).



---



### 5. Рекомендации для улучшения модели Prophet:



| Рекомендация                                 | Описание                                                                 |
|----------------------------------------------|--------------------------------------------------------------------------|
| Добавление сезонности и праздничных факторов | Уточните сезонность (годовая, квартальная, месячная)                     |
| Использование дополнительных регрессоров     | Добавьте внешние признаки (экономические индексы, новости, sentiment)    |
| Оптимизация параметров Prophet               | Настройте гиперпараметры (`changepoint_prior_scale`, `seasonality_mode`) |
| Использование большего количества данных     | Увеличение исторических данных позволит лучше отлавливать тренды         |



---



### Итоговый вывод:



Модель Prophet показала удовлетворительный результат по метрике sMAPE, однако качество прогнозирования абсолютных значений существенно ниже, чем у AutoML. Она проигрывает в предсказании трендов и долгосрочной динамики. Для эффективного использования модели Prophet требуется дополнительная работа по подбору параметров и интеграции внешних признаков.
